@model Raffle.Web.Models.Raffle.RaffleOrderViewModel

@{
    ViewData["Title"] = "Raffle";
}

@section Scripts {
<script type="text/javascript" src="/js/rafflecart.js"></script>
}
<div class="row">
    <div class="col-md-2"></div>
    <div class="col-md-8">
        <img src="~/images/DFDQ-RaffleBanner.png" class="img-fluid" alt="Welcome to the Darts for Dreams Quarantine Edition Raffle" />
    </div>
</div>
<p>
    THIS PAGE WILL STOP TAKING CHOICES AT 2 PM on Saturday August 22nd. That's just xD xH xM away!!!
</p>
<p>
    Thanks for deciding to come here, take a look, and help Make-A-Wish NJ via our unusual 
    Darts for Dreams event this year. What's usually a fun, on-site event where we play 
    darts, hang out and win things has turned into a few weeks of online donations and a 
    selection of about 50 prizes to win. Below, just enter the number of tickets you're 
    interested in for each of the prizes shown. The item, description, sale value and ticket 
    point value are shown. When you hit the CONTINUE button on the bottom, you'll tell us who 
    you are and we'll tell you where to make your donation. Be aware - there may be a few items 
    that are over 21 only, and a few that I won't send and will require a local pickup (Ewing NJ). 
    Items are either 3, 5 or 10 points per chance. Some items will have multiple winners, noted 
    in the description or other information.
</p>
<div class="row">
    <div class="nb-3">
        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="alert alert-danger" role="alert">
                @Model.ErrorMessage
            </div>
        }
    </div>
</div>
<form asp-action="Index" method="get">
    <div class="form-actions no-color">
        <p>
            <b>Find by name:</b> <input type="text" name="searchFilter" value="@ViewData["currentFilter"]" />
            <input type="submit" value="Search" class="btn btn-primary" /> |
            <a asp-action="Index">clear search</a>
        </p>
    </div>
</form>

<form method="post">
    <div class="row">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col"><a asp-action="Index" asp-route-sortBy="@ViewData["itemNumberSortParam"]">Num</a></th>
                    <th scope="col"><a asp-action="Index" asp-route-sortBy="@ViewData["titleSortParam"]">Item</a></th>
                    <th scope="col"><a asp-action="Index" asp-route-sortBy="@ViewData["categorySortParam"]">Category</a></th>
                    <th scope="col"><a asp-action="Index" asp-route-sortBy="@ViewData["pointsSortParam"]">Points</a></th>
                    <th scope="col">How Many</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.RaffleItems.Count; i++)
                {
                    <tr>
                        <td class="text-center align-middle">
                            #@Model.RaffleItems[i].ItemNumber @Html.HiddenFor(x => x.RaffleItems[i].ItemNumber)
                        </td>
                        <td class=" align-middle">
                            @Html.HiddenFor(m => m.RaffleItems[i].Id)
                            <div style="margin-bottom: 8px;">
                                @if (Model.RaffleItems[i].Pictures.Count == 1)
                                {
                                    <a href="@Model.RaffleItems[i].Pictures.First()" target="_blank" rel="noopener noreferrer">
                                        <img src="@Model.RaffleItems[i].Pictures.First()" class="rounded float-left" style="max-width: 120px; margin-right:8px;" alt="@Model.RaffleItems[i].Title">
                                    </a>
                                }
                                <h5>@Model.RaffleItems[i].Title @Html.HiddenFor(x => x.RaffleItems[i].Title)</h5>
                                <div>
                                    @if (!string.IsNullOrEmpty(Model.RaffleItems[i].Description))
                                    {
                                        @Model.RaffleItems[i].Description<br />
                                    }
                                    @if (!string.IsNullOrEmpty(Model.RaffleItems[i].Sponsor))
                                    {
                                        <b>Donated By: </b><span class="font-italic">@Model.RaffleItems[i].Sponsor</span><br />
                                    }
                                    @if (Model.RaffleItems[i].NumberOfDraws > 1)
                                    {
                                        <span class="badge badge-success" title="Number of tickets drawn">@Model.RaffleItems[i].NumberOfDraws Winners</span>
                                    }
                                    @if (Model.RaffleItems[i].LocalPickupOnly)
                                    {
                                        <span class="badge badge-primary">Local Pickup Only</span>
                                    }
                                    @if (Model.RaffleItems[i].ForOver21)
                                    {
                                        <span class="badge badge-warning">Over 21</span>
                                    }
                                </div>
                            </div>
                            @if (Model.RaffleItems[i].Pictures.Count > 1)
                            {
                            <div>
                                @foreach (var picture in Model.RaffleItems[i].Pictures)
                                {
                                <a href="@picture" target="_blank" rel="noopener noreferrer">
                                    <img src="@picture" class="rounded float-left" style="max-width: 100px; margin-right:8px;" alt="@Model.RaffleItems[i].Title">
                                </a>
                                }
                            </div>
                            }
                        </td>
                        <td class="text-center align-middle">@Model.RaffleItems[i].Category</td>
                        <td class="text-center align-middle">@Model.RaffleItems[i].Cost @Html.HiddenFor(x => x.RaffleItems[i].Cost)</td>
                        <td class="text-center align-middle">
                            @Html.TextBoxFor(x =>
                                x.RaffleItems[i].Amount, 
                                null, 
                                new { style = "width:50px", 
                                    @class = "form-control ticketInput", 
                                    data_raffle_item_id=Model.RaffleItems[i].Id 
                                })

                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="row">
        <div class="col-md-6">
            <button type="submit" class="form-control btn btn-primary">Continue</button>
        </div>
        <div class="col-md-6">
            @Html.ActionLink("Clear Donation", "ClearDonation", "Home", null, new { @class = "btn btn-warning" })
        </div>
    </div>
</form>